<script>
    //從後端抓資料(get)

    //1.新增一個XMLHttpRequest
    let xhr = new XMLHttpRequest();
    
    //2.要打開哪個php檔(方法,"位置",)
    xhr.open("get", "./test_getquestion.php", true);

    //2.5.自己打變數的位置(問號後面是要查詢的東西)
    var url = "./test_getquestion.php?test_input=" + test_input.value;
    xhr.open("get", url, true);
    
    //3.把資料送出去(get是null,post)
    xhr.send(null);

    //4.收到資料之後要做的事情(這裡可以抓JSON.parse(xhr.responseText)) -- AJAX課本的20頁
    xhr.onload = function(){};

    //=========================================//

    //從後端抓資料(post) -- login_navbar_json/login.js

    //1.新增一個XMLHttpRequest
    let xhr = new XMLHttpRequest();

    //2.要打開哪個php檔(方法,"位置",)
    xhr.open("post", "ajaxLogin.php", true);
    xhr.setRequestHeader("content-type","application/x-www-form-urlencoded");
     
    //4.收到資料之後要做的事情
    xhr.onload = function(){
        let member = JSON.parse(xhr.responseText);
        $id("memName").innerText = member.memName;
        $id("spanLogin").innerText = "登出";
        $id('lightBox').style.display = 'none';
        $id('memId').value = '';
        $id('memPsw').value = '';
    }

    //5.post要傳的資料(js物件)
    let datas = {}; //新增空的js物件
    datas.memId = $id("memId").value;
    datas.memPsw = $id("memPsw").value;

    //===> datas = {
    //             memId:$id("memId").value;
    //             memId:$id("memPsw").value;
    // };

    //6.把js物件轉成json格式(PHP才看得懂)
    let data_info = `json=${JSON.stringify(datas)}`;

    //7.把資料送出去
    xhr.send(data_info);
</script>


<?php

//try代表作下面的動作
//catch(PDOException $e)出錯的時候跑的動作

try{
	//=====連接資料庫=====//

    //1.自己用的
    $dbname = "資料庫名稱";
	$user = "root"; //帳號
	$password = ""; //密碼

    //連接資料庫的變數(固定寫法)
	$dsn = "mysql:host=localhost;port=3306;dbname=$dbname;charse=utf8";
	$options = [PDO::ATTR_CASE=>PDO::CASE_NATURAL, PDO::ATTR_ERRMODE=>PDO::ERRMODE_EXCEPTION];

    //新增連接資料庫的物件(固定寫法)
	$pdo = new PDO($dsn, $user, $password, $options);
    
    //2.上線之後用的
    // require_once("connect_cgd101g1.php");


    //=====要資料庫做的事情=====//

    //1.sql指令
	$sql = "SELECT * FROM `q_data` WHERE lesson_id =:test;";
	
    //2.要資料庫準備接收指令
	$get_qdata = $pdo->prepare($sql);
	//前台input傳來的變數(看是get還是post),可以用在sql指令中
	$get_qdata->bindValue(":test", $_GET["test_input"]);

    //3.執行sql指令
	$get_qdata->execute();

    //4.要抓全部還是只抓值
	$q_data = $get_qdata->fetchAll(PDO::FETCH_ASSOC);

    //5.把資料傳回去js檔(變成js檔的xhr.responseText，可以放在onload用)
	echo json_encode($q_data);

}catch(PDOException $e){
	//$msg =  "系統暫時無法提供服務, 請聯絡系統維護人員<br>";
	echo "錯誤訊息 : ", $e->getMessage(), "<br>";
	echo "錯誤行號 : ", $e->getLine(), "<br>";
}

?>